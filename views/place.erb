<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>Google Maps API ver 3</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/css/main.css" type="text/css" media="all">

<!-- Bootstrap core CSS -->
<link href="http://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.1/css/bootstrap.css" rel="stylesheet" media="screen">

<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/respond.js/1.3.0/respond.js"></script>
<![endif]-->


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>

</head>
<body>
<div id="map-container" class="col-md-6"></div>

<script type="text/javascript">

var map;

$('document').ready(function(){
  google.maps.event.addDomListener(window, 'load', initialize);
});

function initialize()
{
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);


      map = new google.maps.Map(
        document.getElementById("map-container"),{
          zoom : 13,
          center : latlng,
          mapTypeId : google.maps.MapTypeId.ROADMAP
      });

      var marker = new google.maps.Marker({
        position: latlng,
        map: map,
        title: '現在地'
      });


      map.data.loadGeoJson("/geo/");

      map.data.setStyle(function(feature) {
          var theaterName = feature.getProperty('name');
          return {
            icon: {url: "https://maps.gstatic.com/mapfiles/ms2/micons/marina.png" },
            visible: true,
            clickable: true,
            title: theaterName
          };
      });



      map.data.addListener('addfeature', function(event) {
        var infowindow = new google.maps.InfoWindow();
        var myHTML = event.feature.getProperty("description");

        infowindow.setContent("<div style='width:150px; text-align: center;'>"+myHTML+"</div>");
        infowindow.setPosition(event.feature.getGeometry().get());
        infowindow.setOptions({pixelOffset: new google.maps.Size(0,-30)});
        infowindow.open(map);
		  });



    }, function (e) {

    });
  }


}


</script>
</body>
</html>
