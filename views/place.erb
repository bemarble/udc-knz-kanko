
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
<script src="/js/bootstrap.min.js"></script>
<div class="screen">

  <div id="map-container"></div>

  <div class="overlay">
    <a href="" id="add_req"><img class="add-btn" src="https://pbs.twimg.com/profile_images/3029243482/1cfa579099426f95dbef37e861a0db52.png"></a>
  </div>
</div>





<div class="modal fade" id="modal-window" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">いまの状況は？</h4>
      </div>
      <div class="modal-body">


        <div class="form-group">
          <p class="control-label"><b>状況</b></p>
          <div class="radio-inline">
            <input type="radio" value="1" name="gender" id="man">
            <label for="want">行きたい</label>
          </div>
          <div class="radio-inline">
            <input type="radio" value="2" name="gender" id="woman">
            <label for="go">行こう</label>
          </div>
        </div>

        <div class="form-group">
          <p class="control-label"><b>メッセージ</b></p>
          <div class="col-sm-10">
            <input id="message" type="text" class="form-control" placeholder="どうしましたか？">
          </div>
        </div>
      </div>

      <br />
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="register_state">Save changes</button>
      </div>
    </div>
  </div>
</div>





<script type="text/javascript">

var map;

$('document').ready(function(){
  google.maps.event.addDomListener(window, 'load', initialize);


  $('#add_req').on('click', function(){
    $('#modal-window').modal();
    $('#modal-window').modal({ keyboard: false });
    $('#modal-window').modal('show');

    return false;
  });

  $('#register_state').on('click', function() {
    $.ajax({
      type: 'post',
      url: '/register_state',
      data: {
        'message': $('#message').val()
      },
      success: function() {
        $('#modal-window').modal('hide');
        console.log("reg");
      }
    });

  });
});

function initialize()
{
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var latlng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);


      map = new google.maps.Map(
        document.getElementById("map-container"),{
          zoom : 13,
          center : latlng,
          mapTypeId : google.maps.MapTypeId.ROADMAP
        });

        var marker = new google.maps.Marker({
          position: latlng,
          map: map,
          title: '現在地'
        });


        map.data.loadGeoJson("/geo/");

        map.data.setStyle(function(feature) {
          var theaterName = feature.getProperty('name');
          return {
            icon: {url: "/img/icon.gif" },
            visible: true,
            clickable: true,
            title: theaterName
          };
        });



        map.data.addListener('addfeature', function(event) {
          var infowindow = new google.maps.InfoWindow();
          var myHTML = event.feature.getProperty("description");

          infowindow.setContent("<div style='width:150px; text-align: center;'>"+myHTML+"</div>");
          infowindow.setPosition(event.feature.getGeometry().get());
          infowindow.setOptions({pixelOffset: new google.maps.Size(0,-30)});
          infowindow.open(map);
        });



      }, function (e) {

      });
    }


  }


</script>
